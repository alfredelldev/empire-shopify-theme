{% comment %}
  @param is_product_page {Bool}
{% endcomment %}

{{ 'component-color-swatch.css' | asset_url | stylesheet_tag }}

{%- assign is_product_page = is_product_page -%}

<div class="{% if is_product_page %}color-swatch-product__container{% else %}color-swatch__container{% endif %}">
  {% if is_product_page %}
    <p><strong>Color</strong></p>
  {% endif %}

  {%- assign current_color_tag = '' -%}

  {%- comment %}
    Extract the current product's color name from tags
  {%- endcomment %}
  {%- for tag in product.tags -%}
    {%- if tag contains 'Colour_' -%}
      {%- assign current_color_tag = tag | replace: 'Colour_', '' | replace: ' ', '-' | downcase -%}
    {%- endif -%}
  {%- endfor -%}

  <div class="color-options">
    {%- if current_color_tag != '' -%}
      <a
        href="{{ product.url }}"
        class="color-swatch__circle swatch-img {{ current_color_tag }} selected"
        title="{{ product.title }}"
      ></a>
    {%- endif -%}

    {%- if product.metafields.custom.color_options.value -%}
      {%- for variant in product.metafields.custom.color_options.value -%}
        {%- assign color_tag = '' -%}

        {%- for tag in variant.tags -%}
          {%- if tag contains 'Colour_' -%}
            {%- assign color_tag = tag | replace: 'Colour_', '' | replace: ' ', '-' | downcase -%}
          {%- endif -%}
        {%- endfor -%}

        {%- if color_tag != '' and color_tag != current_color_tag -%}
          <a
            href="{{ variant.url }}"
            class="color-swatch__circle swatch-img {{ color_tag }}"
            title="{{ variant.title }}"
          ></a>
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
  </div>
</div>
